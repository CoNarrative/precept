<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>precept.util documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Precept</span> <span class="project-version">0.5.0-alpha</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>precept</span></div></div></li><li class="depth-2 branch"><a href="precept.accumulators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>accumulators</span></div></a></li><li class="depth-2 branch"><a href="precept.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="precept.dsl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dsl</span></div></a></li><li class="depth-2 branch"><a href="precept.listeners.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>listeners</span></div></a></li><li class="depth-2 branch"><a href="precept.macros.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macros</span></div></a></li><li class="depth-2 branch"><a href="precept.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-2 branch"><a href="precept.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="precept.rules.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rules</span></div></a></li><li class="depth-2 branch"><a href="precept.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></div></li><li class="depth-3 branch"><a href="precept.spec.error.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>error</span></div></a></li><li class="depth-3 branch"><a href="precept.spec.lang.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lang</span></div></a></li><li class="depth-3"><a href="precept.spec.sub.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sub</span></div></a></li><li class="depth-2 branch"><a href="precept.state.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-2 current"><a href="precept.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="precept.util.html#var-add-to-unique-index.21"><div class="inner"><span>add-to-unique-index!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-any-Tuple.3F"><div class="inner"><span>any-Tuple?</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-check-unique-conflict"><div class="inner"><span>check-unique-conflict</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-clara-tups-.3Emaps"><div class="inner"><span>clara-tups-&gt;maps</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-conflicting-logical-fact-error"><div class="inner"><span>conflicting-logical-fact-error</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-conform-insertions-and-retractions.21"><div class="inner"><span>conform-insertions-and-retractions!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-dissoc-in"><div class="inner"><span>dissoc-in</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-entity-map-.3ETuples"><div class="inner"><span>entity-map-&gt;Tuples</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-entity-Tuples-.3Eentity-maps"><div class="inner"><span>entity-Tuples-&gt;entity-maps</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-fact-index-path"><div class="inner"><span>fact-index-path</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-fact-index-paths"><div class="inner"><span>fact-index-paths</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-find-sub-by-name"><div class="inner"><span>find-sub-by-name</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-gen-Tuples-from-map"><div class="inner"><span>gen-Tuples-from-map</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-get-index-of"><div class="inner"><span>get-index-of</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-guid"><div class="inner"><span>guid</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-insert"><div class="inner"><span>insert</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-insert.21"><div class="inner"><span>insert!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-insert-unconditional.21"><div class="inner"><span>insert-unconditional!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-insertable"><div class="inner"><span>insertable</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-key-by"><div class="inner"><span>key-by</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-make-activation-group-fn"><div class="inner"><span>make-activation-group-fn</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-make-activation-group-sort-fn"><div class="inner"><span>make-activation-group-sort-fn</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-make-ancestors-fn"><div class="inner"><span>make-ancestors-fn</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-map-.3Etuples"><div class="inner"><span>map-&gt;tuples</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-map-of-refs.3F"><div class="inner"><span>map-of-refs?</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-next-fact-id.21"><div class="inner"><span>next-fact-id!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-record-.3Emap"><div class="inner"><span>record-&gt;map</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-record-.3Evec"><div class="inner"><span>record-&gt;vec</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-remove-fact-from-index.21"><div class="inner"><span>remove-fact-from-index!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-remove-from-fact-index.21"><div class="inner"><span>remove-from-fact-index!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-remove-rulegen-facts"><div class="inner"><span>remove-rulegen-facts</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-reset-fact-id.21"><div class="inner"><span>reset-fact-id!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-retract"><div class="inner"><span>retract</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-retract.21"><div class="inner"><span>retract!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-rulegen-fact-nses"><div class="inner"><span>rulegen-fact-nses</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-rulegen-fact.3F"><div class="inner"><span>rulegen-fact?</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-rules-in-ns"><div class="inner"><span>rules-in-ns</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-schema-enforcement-dto"><div class="inner"><span>schema-enforcement-dto</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-split-head-body"><div class="inner"><span>split-head-body</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-third"><div class="inner"><span>third</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-trace"><div class="inner"><span>trace</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-tuple-entity-.3Ehash-map-entity"><div class="inner"><span>tuple-entity-&gt;hash-map-entity</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-Tuples-.3Emaps"><div class="inner"><span>Tuples-&gt;maps</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-tuplize-into-vec"><div class="inner"><span>tuplize-into-vec</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-unknown-ancestry-error"><div class="inner"><span>unknown-ancestry-error</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-update-index.21"><div class="inner"><span>update-index!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-update-unique-index.21"><div class="inner"><span>update-unique-index!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-upsert-fact-index.21"><div class="inner"><span>upsert-fact-index!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-upsert-unique-index.21"><div class="inner"><span>upsert-unique-index!</span></div></a></li><li class="depth-1"><a href="precept.util.html#var-vec-.3Erecord"><div class="inner"><span>vec-&gt;record</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">precept.util</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-add-to-unique-index.21"><h3>add-to-unique-index!</h3><div class="usage"><code>(add-to-unique-index! fact ks)</code></div><div class="doc"><div class="markdown"><p>Prepreds :unique to keyseq path in second argument. Overwrites existing value and returns it if found.</p></div></div></div><div class="public anchor" id="var-any-Tuple.3F"><h3>any-Tuple?</h3><div class="usage"><code>(any-Tuple? x)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-check-unique-conflict"><h3>check-unique-conflict</h3><div class="usage"><code>(check-unique-conflict fact ks)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-clara-tups-.3Emaps"><h3>clara-tups-&gt;maps</h3><div class="usage"><code>(clara-tups-&gt;maps tups)</code></div><div class="doc"><div class="markdown"><p>Takes seq of ms with keys :?e :?a :?v, joins on :?e and returns vec of ms (one m for each entity)</p></div></div></div><div class="public anchor" id="var-conflicting-logical-fact-error"><h3>conflicting-logical-fact-error</h3><div class="usage"><code>(conflicting-logical-fact-error facts to-insert to-retract)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-conform-insertions-and-retractions.21"><h3>conform-insertions-and-retractions!</h3><div class="usage"><code>(conform-insertions-and-retractions! facts)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-dissoc-in"><h3>dissoc-in</h3><div class="usage"><code>(dissoc-in m [k &amp; ks :as keys])</code></div><div class="doc"><div class="markdown"><p>Dissociates an entry from a nested associative structure returning a new nested structure. keys is a sequence of keys. Any empty maps that result will not be present in the new structure.</p></div></div></div><div class="public anchor" id="var-entity-map-.3ETuples"><h3>entity-map-&gt;Tuples</h3><div class="usage"><code>(entity-map-&gt;Tuples m)</code></div><div class="doc"><div class="markdown"><p>Transforms entity map to Tuple record {a1 v1 a2 v2 :db/id eid} -&gt; [(Tuple eid a1 v1 t)…]</p></div></div></div><div class="public anchor" id="var-entity-Tuples-.3Eentity-maps"><h3>entity-Tuples-&gt;entity-maps</h3><div class="usage"><code>(entity-Tuples-&gt;entity-maps coll)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-fact-index-path"><h3>fact-index-path</h3><div class="usage"><code>(fact-index-path fact)</code></div><div class="doc"><div class="markdown"><p>Returns path to store and access a fact in fact-index according to the fact’s cardinality, uniqueness</p></div></div></div><div class="public anchor" id="var-fact-index-paths"><h3>fact-index-paths</h3><div class="usage"><code>(fact-index-paths fact)</code></div><div class="doc"><div class="markdown"><p>Returns all index paths for a given fact as [[]…]</p></div></div></div><div class="public anchor" id="var-find-sub-by-name"><h3>find-sub-by-name</h3><div class="usage"><code>(find-sub-by-name name)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-gen-Tuples-from-map"><h3>gen-Tuples-from-map</h3><div class="usage"><code>(gen-Tuples-from-map m)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-get-index-of"><h3>get-index-of</h3><div class="usage"><code>(get-index-of coll x not-found-idx)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-guid"><h3>guid</h3><div class="usage"><code>(guid)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-insert"><h3>insert</h3><div class="usage"><code>(insert session facts)</code></div><div class="doc"><div class="markdown"><p>Inserts facts from outside rule context. Accepts <code>[e a v]</code>, <code>[[e a v]...]</code>, <code>{}</code>, <code>[{}...]</code>, where <code>{}</code> is a Datomic-style entity map</p></div></div></div><div class="public anchor" id="var-insert.21"><h3>insert!</h3><div class="usage"><code>(insert! facts)</code></div><div class="doc"><div class="markdown"><p>Insert facts logically within rule context</p></div></div></div><div class="public anchor" id="var-insert-unconditional.21"><h3>insert-unconditional!</h3><div class="usage"><code>(insert-unconditional! facts)</code></div><div class="doc"><div class="markdown"><p>Insert facts unconditionally within rule context</p></div></div></div><div class="public anchor" id="var-insertable"><h3>insertable</h3><div class="usage"><code>(insertable x)</code></div><div class="doc"><div class="markdown"><p>Arguments can be any mixture of vectors and records Ensures [], [[]…], Tuple, ’(Tuple …) conform to Tuple record instances.</p></div></div></div><div class="public anchor" id="var-key-by"><h3>key-by</h3><div class="usage"><code>(key-by f coll)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-make-activation-group-fn"><h3>make-activation-group-fn</h3><div class="usage"><code>(make-activation-group-fn default-group)</code></div><div class="doc"><div class="markdown"><p>Reads from optional third argument to rule. <code>:super</code> - boolean <code>:group</code> - keyword <code>:salience</code> - number  Rules marked <code>:super</code> are given the highest priority.</p></div></div></div><div class="public anchor" id="var-make-activation-group-sort-fn"><h3>make-activation-group-sort-fn</h3><div class="usage"><code>(make-activation-group-sort-fn groups default-group)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-make-ancestors-fn"><h3>make-ancestors-fn</h3><div class="usage"><code>(make-ancestors-fn)</code><code>(make-ancestors-fn hierarchy)</code><code>(make-ancestors-fn hierarchy root-fact-type)</code></div><div class="doc"><div class="markdown"><p>Returns a set. To be used when defining a session. Stored in atom for auto truth maintenance and schema enforcement.</p></div></div></div><div class="public anchor" id="var-map-.3Etuples"><h3>map-&gt;tuples</h3><div class="usage"><code>(map-&gt;tuples m)</code></div><div class="doc"><div class="markdown"><p>Transforms entity map to vector of tuples {a1 v1 a2 v2 :db/id eid} -&gt; [[eid a1 v1]…]</p></div></div></div><div class="public anchor" id="var-map-of-refs.3F"><h3>map-of-refs?</h3><div class="usage"><code>(map-of-refs? schemas x)</code></div><div class="doc"><div class="markdown"><p>Returns true if every k is db.type/ref according to a schema</p></div></div></div><div class="public anchor" id="var-next-fact-id.21"><h3>next-fact-id!</h3><div class="usage"><code>(next-fact-id!)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-record-.3Emap"><h3>record-&gt;map</h3><div class="usage"><code>(record-&gt;map x)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-record-.3Evec"><h3>record-&gt;vec</h3><div class="usage"><code>(record-&gt;vec r)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-remove-fact-from-index.21"><h3>remove-fact-from-index!</h3><div class="usage"><code>(remove-fact-from-index! fact)</code><code>(remove-fact-from-index! fact paths)</code></div><div class="doc"><div class="markdown"><p>Removes fact from all indexed locations according to schema if the indexed value is identical to the <code>fact</code> argument. Returns <code>[bool...]</code> indicating successful removal from each indexed location.</p></div></div></div><div class="public anchor" id="var-remove-from-fact-index.21"><h3>remove-from-fact-index!</h3><div class="usage"><code>(remove-from-fact-index! fact ks)</code></div><div class="doc"><div class="markdown"><p>Removes fact from single path in index, returning a retract instruction if an exact match was found</p></div></div></div><div class="public anchor" id="var-remove-rulegen-facts"><h3>remove-rulegen-facts</h3><div class="usage"><code>(remove-rulegen-facts xs)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-reset-fact-id.21"><h3>reset-fact-id!</h3><div class="usage"><code>(reset-fact-id!)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-retract"><h3>retract</h3><div class="usage"><code>(retract session facts)</code></div><div class="doc"><div class="markdown"><p>Retract from outside rule context.</p></div></div></div><div class="public anchor" id="var-retract.21"><h3>retract!</h3><div class="usage"><code>(retract! facts)</code></div><div class="doc"><div class="markdown"><p>Wrapper around Clara’s <code>retract!</code>. Use within RHS of rule only. Requires a fact that includes a fact-id produced by matching on a whole fact. e.g. <code>?fact</code> in <code>[?fact &lt;- [?e :attr ?v]</code></p></div></div></div><div class="public anchor" id="var-rulegen-fact-nses"><h3>rulegen-fact-nses</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-rulegen-fact.3F"><h3>rulegen-fact?</h3><div class="usage"><code>(rulegen-fact? a)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-rules-in-ns"><h3>rules-in-ns</h3><div class="usage"><code>(rules-in-ns ns-sym)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-schema-enforcement-dto"><h3>schema-enforcement-dto</h3><div class="usage"><code>(schema-enforcement-dto inserted retracted index-path)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-split-head-body"><h3>split-head-body</h3><div class="usage"><code>(split-head-body rule)</code></div><div class="doc"><div class="markdown"><p>Takes macro body of a define and returns map of :head, :body</p></div></div></div><div class="public anchor" id="var-third"><h3>third</h3><div class="usage"><code>(third xs)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-trace"><h3>trace</h3><div class="usage"><code>(trace &amp; args)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-tuple-entity-.3Ehash-map-entity"><h3>tuple-entity-&gt;hash-map-entity</h3><div class="usage"><code>(tuple-entity-&gt;hash-map-entity tuples)</code></div><div class="doc"><div class="markdown"><p>Takes list of tuples for a <em>single</em> entity and returns single map</p></div></div></div><div class="public anchor" id="var-Tuples-.3Emaps"><h3>Tuples-&gt;maps</h3><div class="usage"><code>(Tuples-&gt;maps xs)</code><code>(Tuples-&gt;maps xs ancestry)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-tuplize-into-vec"><h3>tuplize-into-vec</h3><div class="usage"><code>(tuplize-into-vec x)</code></div><div class="doc"><div class="markdown"><p>Returns [[]…]. Arg may be {} [{}…] [] [[]…]</p></div></div></div><div class="public anchor" id="var-unknown-ancestry-error"><h3>unknown-ancestry-error</h3><div class="usage"><code>(unknown-ancestry-error fact ancestry)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-update-index.21"><h3>update-index!</h3><div class="usage"><code>(update-index! fact)</code><code>(update-index! fact ks)</code></div><div class="doc"><div class="markdown"><p>Primary function that updates fact-index. Requires fact to index. Generates key-seq to path in index.</p></div></div></div><div class="public anchor" id="var-update-unique-index.21"><h3>update-unique-index!</h3><div class="usage"><code>(update-unique-index! fact ks)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-upsert-fact-index.21"><h3>upsert-fact-index!</h3><div class="usage"><code>(upsert-fact-index! fact ks)</code></div><div class="doc"><div class="markdown"><p>Writes value to path in ks. Returns existing fact to retract if overwriting.</p></div></div></div><div class="public anchor" id="var-upsert-unique-index.21"><h3>upsert-unique-index!</h3><div class="usage"><code>(upsert-unique-index! fact ks)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-vec-.3Erecord"><h3>vec-&gt;record</h3><div class="usage"><code>(vec-&gt;record vec)</code></div><div class="doc"><div class="markdown"></div></div></div></div></body></html>