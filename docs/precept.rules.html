<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>precept.rules documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Precept</span> <span class="project-version">0.5.0-alpha</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>precept</span></div></div></li><li class="depth-2 branch"><a href="precept.accumulators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>accumulators</span></div></a></li><li class="depth-2 branch"><a href="precept.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="precept.dsl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dsl</span></div></a></li><li class="depth-2 branch"><a href="precept.listeners.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>listeners</span></div></a></li><li class="depth-2 branch"><a href="precept.macros.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macros</span></div></a></li><li class="depth-2 branch"><a href="precept.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-2 branch"><a href="precept.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch current"><a href="precept.rules.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rules</span></div></a></li><li class="depth-2 branch"><a href="precept.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></div></li><li class="depth-3 branch"><a href="precept.spec.error.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>error</span></div></a></li><li class="depth-3 branch"><a href="precept.spec.lang.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lang</span></div></a></li><li class="depth-3"><a href="precept.spec.sub.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sub</span></div></a></li><li class="depth-2 branch"><a href="precept.state.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-2"><a href="precept.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="precept.rules.html#var-compiling-cljs.3F"><div class="inner"><span>compiling-cljs?</span></div></a></li><li class="depth-1"><a href="precept.rules.html#var-define"><div class="inner"><span>define</span></div></a></li><li class="depth-1"><a href="precept.rules.html#var-defquery"><div class="inner"><span>defquery</span></div></a></li><li class="depth-1"><a href="precept.rules.html#var-defsub"><div class="inner"><span>defsub</span></div></a></li><li class="depth-1"><a href="precept.rules.html#var-fire-rules"><div class="inner"><span>fire-rules</span></div></a></li><li class="depth-1"><a href="precept.rules.html#var-q"><div class="inner"><span>q</span></div></a></li><li class="depth-1"><a href="precept.rules.html#var-rule"><div class="inner"><span>rule</span></div></a></li><li class="depth-1"><a href="precept.rules.html#var-session"><div class="inner"><span>session</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">precept.rules</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-compiling-cljs.3F"><h3>compiling-cljs?</h3><div class="usage"><code>(compiling-cljs?)</code></div><div class="doc"><div class="markdown"><p>Return true if we are currently generating cljs code. Useful because cljx does not provide a hook for conditional macro expansion.</p></div></div></div><div class="public anchor" id="var-define"><h3>define</h3><h4 class="type">macro</h4><div class="usage"><code>(define &amp; forms)</code></div><div class="doc"><div class="markdown"><p>Prolog-style rule.</p>
<p>(define [?e :derived-fact ?v] :- <a href="null">?e :my-fact ?v</a>)</p>
<p>Head/consequence is declared first followed by body/conditions. Uses :- as separator. Name is auto-generated. Auto-assigned to default activation group. Inserts are always logical. Does not support non-DSL syntax (e.g. println, let).</p></div></div></div><div class="public anchor" id="var-defquery"><h3>defquery</h3><h4 class="type">macro</h4><div class="usage"><code>(defquery name &amp; body)</code></div><div class="doc"><div class="markdown"><p>Clara’s defquery with precept DSL.</p>
<p>(defquery my-query [:v]
  [?fact &lt;- [_ :my-fact ?v]])</p>
<p>Defines a named query that can be called with Clara’s <code>query</code> function with optional  arguments.</p></div></div></div><div class="public anchor" id="var-defsub"><h3>defsub</h3><h4 class="type">macro</h4><div class="usage"><code>(defsub kw &amp; body)</code></div><div class="doc"><div class="markdown"><p>Defines subscription response.</p>
<p>(defsub :my-sub-name  <a href="null">_ :my-fact ?v</a>  =&gt;  {:my-fact ?v})</p>
<p>sub-name - keyword of subscription registered with <code>subscribe</code>  LHS - any valid LHS syntax  RHS - a hash-map to be passed to subscribers of sub-name</p></div></div></div><div class="public anchor" id="var-fire-rules"><h3>fire-rules</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-q"><h3>q</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-rule"><h3>rule</h3><h4 class="type">macro</h4><div class="usage"><code>(rule name &amp; body)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-session"><h3>session</h3><h4 class="type">macro</h4><div class="usage"><code>(session name &amp; sources-and-options)</code></div><div class="doc"><div class="markdown"><p>Defines a session.</p>
<p>(session my-session ’my-proj/my-ns :db-schema my-schema)</p>
<p>Accepts same arguments as Clara’s defsession plus :db-schema and :client-schema options. Rules and queries are loaded from the provided namespace. To load rules from multiple namespaces, a vector of namespaces may be provided.</p>
<p>:db-schema - Datomic-format schema for persistent facts. Precept enforces cardinality and  uniqueness similarly to Datomic. All facts are treated as non-unique and one-to-one  cardinality by default.</p>
<p>:client-schema - Datomic-format schema for non-perstent facts. Precept enforces cardinality  and uniqueness for attributes in this schema the same way it does for :db-schema. It  serves two main purposes. 1. To define client-side facts as one-to-many or unique. 2. To  allow Precept’s API to filter out facts that should not be persisted when writing to a  database.</p>
<p>Defaults:</p>
<p><code>:fact-type-fn</code> - <code>:a</code>  Tells Clara to index facts by attribute. This is the preferred :fact-type-fn option for  working with eav tuples.</p>
<p><code>:ancestors-fn</code> - <code>util/make-ancestors-fn</code>  If :db-schema and/or :client-schema are provided, uses Clojure’s <code>make-hierarchy</code> and  <code>derive</code> functions to assign cardinality and uniqueness for each provided attribute.  When no schemas are provided, all facts will be descendents of #{:all :one-to-one}.  Because all facts descend from <code>:all</code>, rules written with the <code>:all</code> attribute can  match facts independently of their attributes.</p>
<p><code>:activation-group-fn</code> - <code>(util/make-activation-group-fn :calc)</code>  Allows categorization and prioritization of some rules over others. Puts a rule into a  prioritization group according to the optional first argument to rule.  Assigns the default values <code>{:group :calc :salience 0 :super false}</code> to rules where the  without these arguments.  argument to rule. :salience determines precedence within the same group.  Rules marked :super are active across all groups.</p>
<p><code>:activation-group-sort-fn</code> - <code>(util/make-activation-group-fn [:action :calc :report :cleanup])</code>  Determines the scheme by which some rules are given priority over others. Rules in the  <code>:action</code> group will be given the chance to fire before rules in the <code>:calc</code> group and so on.  When determining the priority of two rules in the same group, the :salience property  serves as a tiebreaker, with higher salience rules receiving precedence over lower salience ones.</p></div></div></div></div></body></html>