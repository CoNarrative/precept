<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>precept.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Precept</span> <span class="project-version">0.5.0-alpha</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>precept</span></div></div></li><li class="depth-2 branch"><a href="precept.accumulators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>accumulators</span></div></a></li><li class="depth-2 branch current"><a href="precept.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="precept.dsl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dsl</span></div></a></li><li class="depth-2 branch"><a href="precept.listeners.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>listeners</span></div></a></li><li class="depth-2 branch"><a href="precept.macros.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macros</span></div></a></li><li class="depth-2 branch"><a href="precept.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-2 branch"><a href="precept.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="precept.rules.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rules</span></div></a></li><li class="depth-2 branch"><a href="precept.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></div></li><li class="depth-3 branch"><a href="precept.spec.error.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>error</span></div></a></li><li class="depth-3 branch"><a href="precept.spec.lang.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lang</span></div></a></li><li class="depth-3"><a href="precept.spec.sub.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sub</span></div></a></li><li class="depth-2 branch"><a href="precept.state.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-2"><a href="precept.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="precept.core.html#var-action-ch"><div class="inner"><span>action-ch</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-apply-additions-to-store"><div class="inner"><span>apply-additions-to-store</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-apply-changes-to-session"><div class="inner"><span>apply-changes-to-session</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-apply-removals-to-store"><div class="inner"><span>apply-removals-to-store</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-batch-complete.3F"><div class="inner"><span>batch-complete?</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-ch-chsk"><div class="inner"><span>ch-chsk</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-changes-mult"><div class="inner"><span>changes-mult</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-changes-out"><div class="inner"><span>changes-out</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-changes-xf"><div class="inner"><span>changes-xf</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-chsk"><div class="inner"><span>chsk</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-chsk-send.21"><div class="inner"><span>chsk-send!</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-chsk-state"><div class="inner"><span>chsk-state</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-connect-devtools-socket.21"><div class="inner"><span>connect-devtools-socket!</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-create-change-report-ch"><div class="inner"><span>create-change-report-ch</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-create-dto.3Esocket-router"><div class="inner"><span>create-dto&gt;socket-router</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-create-fired-session-ch"><div class="inner"><span>create-fired-session-ch</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-default-devtools-options"><div class="inner"><span>default-devtools-options</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-default-group"><div class="inner"><span>default-group</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-devtools-socket-ch"><div class="inner"><span>devtools-socket-ch</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-devtools-socket-router"><div class="inner"><span>devtools-socket-router</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-dispatch.21"><div class="inner"><span>dispatch!</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-done-ch"><div class="inner"><span>done-ch</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-empty-batch.3F"><div class="inner"><span>empty-batch?</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-groups"><div class="inner"><span>groups</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-handle-event"><div class="inner"><span>handle-event</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-handle-message"><div class="inner"><span>handle-message</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-identical-conditions-and-consequences-error"><div class="inner"><span>identical-conditions-and-consequences-error</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-init-session-ch"><div class="inner"><span>init-session-ch</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-init-transactor"><div class="inner"><span>init-transactor</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-lens"><div class="inner"><span>lens</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-matching-conditions-and-consequences"><div class="inner"><span>matching-conditions-and-consequences</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-matching-consequences"><div class="inner"><span>matching-consequences</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-notify.21"><div class="inner"><span>notify!</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-read-changes-from-session"><div class="inner"><span>read-changes-from-session</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-realized-session"><div class="inner"><span>realized-session</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-register"><div class="inner"><span>register</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-register-rule"><div class="inner"><span>register-rule</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-removals-out"><div class="inner"><span>removals-out</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-resume.21"><div class="inner"><span>resume!</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-resume-with-devtools.21"><div class="inner"><span>resume-with-devtools!</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-session-.3Estore"><div class="inner"><span>session-&gt;store</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-session-mult"><div class="inner"><span>session-mult</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-start.21"><div class="inner"><span>start!</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-start-with-devtools.21"><div class="inner"><span>start-with-devtools!</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-subscribe"><div class="inner"><span>subscribe</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-swap-session.21"><div class="inner"><span>swap-session!</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-swap-session-sync.21"><div class="inner"><span>swap-session-sync!</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-then"><div class="inner"><span>then</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-trace"><div class="inner"><span>trace</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-transactor"><div class="inner"><span>transactor</span></div></a></li><li class="depth-1"><a href="precept.core.html#var-update-session-history"><div class="inner"><span>update-session-history</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">precept.core</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-action-ch"><h3>action-ch</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-apply-additions-to-store"><h3>apply-additions-to-store</h3><div class="usage"><code>(apply-additions-to-store in)</code></div><div class="doc"><div class="markdown"><p>Reads ops from channel and applies additions to store</p></div></div></div><div class="public anchor" id="var-apply-changes-to-session"><h3>apply-changes-to-session</h3><div class="usage"><code>(apply-changes-to-session in)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-apply-removals-to-store"><h3>apply-removals-to-store</h3><div class="usage"><code>(apply-removals-to-store in)</code></div><div class="doc"><div class="markdown"><p>Reads ops from in channel and applies removals to store</p></div></div></div><div class="public anchor" id="var-batch-complete.3F"><h3>batch-complete?</h3><div class="usage"><code>(batch-complete? event batch)</code></div><div class="doc"><div class="markdown"><p>Returns true if the event is fire rules complete or it exists in the batch and the maximum event number received is equal to <code>:total-events</code> from fire rules complete</p></div></div></div><div class="public anchor" id="var-ch-chsk"><h3>ch-chsk</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-changes-mult"><h3>changes-mult</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-changes-out"><h3>changes-out</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-changes-xf"><h3>changes-xf</h3><div class="usage"><code>(changes-xf f)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-chsk"><h3>chsk</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-chsk-send.21"><h3>chsk-send!</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-chsk-state"><h3>chsk-state</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-connect-devtools-socket.21"><h3>connect-devtools-socket!</h3><div class="usage"><code>(connect-devtools-socket! options init-cb)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-create-change-report-ch"><h3>create-change-report-ch</h3><div class="usage"><code>(create-change-report-ch)</code><code>(create-change-report-ch f)</code></div><div class="doc"><div class="markdown"><p>Returns core.async channel with operational changes from session. Removes Precept implementation facts when called with no arguments. May be called with a function that will be applied to all :added and :removed facts.</p>
<p>Usage:</p>
<pre><code class="clj">(def nil-values-ch
  (create-changes-report-ch
    (filter (fn [{:keys [e a v t]} record] (nil? v))
            %)))
(go-loop []
  (let [changes (&lt;! nil-values-ch)]
    (println "Facts with nil values added / removed:" changes)))
=&gt; Facts with nil values added / removed: {:added () :removed ()}
</code></pre></div></div></div><div class="public anchor" id="var-create-dto.3Esocket-router"><h3>create-dto&gt;socket-router</h3><div class="usage"><code>(create-dto&gt;socket-router in send! encoding)</code></div><div class="doc"><div class="markdown"><p>Returns a go-loop that takes from a channel with events emitted by <code>precept.listeners/PersistentSessionEventMessager and calls the provided send function,
intended for use with a precept-devtools socket. Batches events per call to</code>fire-rules`.</p></div></div></div><div class="public anchor" id="var-create-fired-session-ch"><h3>create-fired-session-ch</h3><div class="usage"><code>(create-fired-session-ch)</code></div><div class="doc"><div class="markdown"><p>Returns core.async channel that receives the session after the rules have been fired and before its listener has been replaced.</p></div></div></div><div class="public anchor" id="var-default-devtools-options"><h3>default-devtools-options</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-default-group"><h3>default-group</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-devtools-socket-ch"><h3>devtools-socket-ch</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-devtools-socket-router"><h3>devtools-socket-router</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-dispatch.21"><h3>dispatch!</h3><div class="usage"><code>(dispatch! f)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-done-ch"><h3>done-ch</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-empty-batch.3F"><h3>empty-batch?</h3><div class="usage"><code>(empty-batch? event batch)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-groups"><h3>groups</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-handle-event"><h3>handle-event</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-handle-message"><h3>handle-message</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-identical-conditions-and-consequences-error"><h3>identical-conditions-and-consequences-error</h3><div class="usage"><code>(identical-conditions-and-consequences-error {:keys [existing-name type]})</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-init-session-ch"><h3>init-session-ch</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-init-transactor"><h3>init-transactor</h3><div class="usage"><code>(init-transactor)</code></div><div class="doc"><div class="markdown"><p>Parks until session is initialized in (:session precept.state/state) then spawns a transactor that takes from <code>action-ch</code>.</p></div></div></div><div class="public anchor" id="var-lens"><h3>lens</h3><div class="usage"><code>(lens a path)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-matching-conditions-and-consequences"><h3>matching-conditions-and-consequences</h3><div class="usage"><code>(matching-conditions-and-consequences lhs rhs rules-index)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-matching-consequences"><h3>matching-consequences</h3><div class="usage"><code>(matching-consequences rhs rule-index)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-notify.21"><h3>notify!</h3><div class="usage"><code>(notify! sub-name update-fn)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-read-changes-from-session"><h3>read-changes-from-session</h3><div class="usage"><code>(read-changes-from-session in)</code></div><div class="doc"><div class="markdown"><p>Reads changes from session channel, fires rules, and puts resultant changes on changes channel. Updates session state atom with new session. Changes are returned keyed by :added, :removed as Tuple records.</p></div></div></div><div class="public anchor" id="var-realized-session"><h3>realized-session</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-register"><h3>register</h3><div class="usage"><code>(register req)</code></div><div class="doc"><div class="markdown"><p>Should only get called by <code>subscribe</code>, which determines if a sub exists.</p>
<p>Generates an id used to track requests and responses throughout the system.</p>
<p><code>req</code> is a vector of name and params (currently we just support a name). Inserts subscription request into the current session. Responses are generated by subscription handler rules that match request name and insert facts into working memory. Subscriptions are stored in (:subscriptions @state). The lens is a reagent cursor that observes changes to the subscription’s response that is written to the store.</p></div></div></div><div class="public anchor" id="var-register-rule"><h3>register-rule</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Returns rule name if found in registry, else registers new rule and returns name</p></div></div></div><div class="public anchor" id="var-removals-out"><h3>removals-out</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-resume.21"><h3>resume!</h3><div class="usage"><code>(resume! {:keys [session facts devtools], :as options})</code></div><div class="doc"><div class="markdown"><p>Resets session with provided facts if <code>start!</code> has been called, otherwise returns the session received as an argument unmodified. Avoids duplicate session creation on page refresh in development when there is stale session metadata in the compiler.</p></div></div></div><div class="public anchor" id="var-resume-with-devtools.21"><h3>resume-with-devtools!</h3><div class="usage"><code>(resume-with-devtools! options)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-session-.3Estore"><h3>session-&gt;store</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-session-mult"><h3>session-mult</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-start.21"><h3>start!</h3><div class="usage"><code>(start! {:keys [id session facts devtools], :as options})</code></div><div class="doc"><div class="markdown"><p>Initializes session with facts.</p>
<ul>
  <li><code>:session</code> - Instance of clara.rules.engine.LocalSession created by <code>precept.rules/session</code></li>
  <li><code>:id</code> - Value that uniquely identifies the session.</li>
  <li><code>:facts</code> - Vector. Initial facts to be inserted into the session</li>
  <li><code>:devtools</code> (optional) - Boolean or map of options for connecting to a  running instance of a Precept devtools server. Default: <code>nil</code>.  Supported devtools options:</li>
  <li><code>:host</code> - String with host and port separated by <code>:</code>.  Defaults to default Devtools server address and port <code>0.0.0.0:3232</code>.</li>
  <li><code>:path</code> - String of path for server socket.  Defaults to default Devtools server path <code>/chsk</code>.</li>
  <li><code>:encoding</code> - Keyword of encoding for devtools socket.  One of transit enc-types: <code>:json</code>, <code>:json-verbose</code> . Defaults to  <code>:json-verbose</code>.</li>
</ul></div></div></div><div class="public anchor" id="var-start-with-devtools.21"><h3>start-with-devtools!</h3><div class="usage"><code>(start-with-devtools! {:keys [session facts devtools], :as options})</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-subscribe"><h3>subscribe</h3><div class="usage"><code>(subscribe req)</code></div><div class="doc"><div class="markdown"><p>Returns lens that points to a path in the store. Sub is handled by a rule.</p></div></div></div><div class="public anchor" id="var-swap-session.21"><h3>swap-session!</h3><div class="usage"><code>(swap-session! next)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-swap-session-sync.21"><h3>swap-session-sync!</h3><div class="usage"><code>(swap-session-sync! next f)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-then"><h3>then</h3><div class="usage"><code>(then facts)</code></div><div class="doc"><div class="markdown"><p>Inserts facts into current session</p></div></div></div><div class="public anchor" id="var-trace"><h3>trace</h3><div class="usage"><code>(trace &amp; args)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-transactor"><h3>transactor</h3><div class="usage"><code>(transactor)</code></div><div class="doc"><div class="markdown"><p>Takes from action channel and puts to <code>session-&gt;store</code> channel. Parks until <code>done-ch</code> returns a message indicating:  1. A transaction of facts (via <code>then</code>) was inserted into the (global) session  (<code>(:session precept.state/state)</code>)  2. <code>fire-rules</code> was called on <code>(:session precept.state/state)</code>  3. changes were read from the session and applied to the store</p></div></div></div><div class="public anchor" id="var-update-session-history"><h3>update-session-history</h3><div class="usage"><code>(update-session-history session)</code></div><div class="doc"><div class="markdown"><p>First history entry is most recent</p></div></div></div></div></body></html>